---
source: compiler/src/compile/ir/optimisations.rs
expression: output
input_file: compiler/src/compile/ir/snapshot_tests/optimisations/integration/division_by_subtraction.tapir
---
----------- before -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.23 = n.1
r.24 = temp.23
temp.25 = int 0
q.26 = temp.25
jmp 0

---- block 0 ----
r.27 = φ(r.24 from 2, r.37 from 5)
d.29 = φ(d.2 from 2, d.29 from 5)
q.32 = φ(q.26 from 2, q.41 from 5)
temp.28 = r.27
temp.30 = d.29
temp.31 = temp.28 < temp.30
conditional_jump temp.31 3 4

---- block 3 ----
temp.33 = q.32
return temp.33

---- block 4 ----
jmp 5

---- block 5 ----
temp.34 = r.27
temp.35 = d.29
temp.36 = temp.34 - temp.35
r.37 = temp.36
temp.38 = q.32
temp.39 = int 1
temp.40 = temp.38 + temp.39
q.41 = temp.40
jmp 0


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.23 = n.1
r.24 = temp.23
temp.25 = int 0
q.26 = temp.25
jmp 0

---- block 0 ----
r.27 = φ(r.24 from 2, r.37 from 5)
q.32 = φ(q.26 from 2, q.41 from 5)
temp.28 = r.27
temp.30 = d.2
temp.31 = temp.28 < temp.30
conditional_jump temp.31 3 4

---- block 3 ----
temp.33 = q.32
return temp.33

---- block 4 ----
jmp 5

---- block 5 ----
temp.34 = r.27
temp.35 = d.2
temp.36 = temp.34 - temp.35
r.37 = temp.36
temp.38 = q.32
temp.39 = int 1
temp.40 = temp.38 + temp.39
q.41 = temp.40
jmp 0


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.23 = n.1
r.24 = temp.23
temp.25 = int 0
q.26 = temp.25
jmp 0

---- block 0 ----
r.27 = φ(r.24 from 2, r.37 from 5)
q.32 = φ(q.26 from 2, q.41 from 5)
temp.28 = r.27
temp.30 = d.2
temp.31 = temp.28 < temp.30
conditional_jump temp.31 3 4

---- block 3 ----
temp.33 = q.32
return temp.33

---- block 4 ----
temp.34 = r.27
temp.35 = d.2
temp.36 = temp.34 - temp.35
r.37 = temp.36
temp.38 = q.32
temp.39 = int 1
temp.40 = temp.38 + temp.39
q.41 = temp.40
jmp 5

---- block 5 ----
jmp 0


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.23 = n.1
r.24 = n.1
temp.25 = int 0
q.26 = temp.25
jmp 0

---- block 0 ----
r.27 = φ(n.1 from 2, r.37 from 5)
q.32 = φ(temp.25 from 2, q.41 from 5)
temp.28 = r.27
temp.30 = d.2
temp.31 = r.27 < d.2
conditional_jump temp.31 3 4

---- block 3 ----
temp.33 = q.32
return q.32

---- block 4 ----
temp.34 = r.27
temp.35 = d.2
temp.36 = r.27 - d.2
r.37 = temp.36
temp.38 = q.32
temp.39 = int 1
temp.40 = q.32 + temp.39
q.41 = temp.40
jmp 5

---- block 5 ----
jmp 0


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = int 0
jmp 0

---- block 0 ----
r.27 = φ(n.1 from 2, r.37 from 5)
q.32 = φ(temp.25 from 2, q.41 from 5)
temp.31 = r.27 < d.2
conditional_jump temp.31 3 4

---- block 3 ----
return q.32

---- block 4 ----
temp.36 = r.27 - d.2
r.37 = temp.36
temp.39 = int 1
temp.40 = q.32 + temp.39
q.41 = temp.40
jmp 5

---- block 5 ----
jmp 0


----------- immediate_arithmetic -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = int 0
jmp 0

---- block 0 ----
r.27 = φ(n.1 from 2, r.37 from 5)
q.32 = φ(temp.25 from 2, q.41 from 5)
temp.31 = r.27 < d.2
conditional_jump temp.31 3 4

---- block 3 ----
return q.32

---- block 4 ----
temp.36 = r.27 - d.2
r.37 = temp.36
temp.39 = int 1
temp.40 = q.32 + imm(1)
q.41 = temp.40
jmp 5

---- block 5 ----
jmp 0


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.22 = divide(temp.20, temp.21)
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = int 0
jmp 0

---- block 0 ----
r.27 = φ(n.1 from 2, r.37 from 5, r.37 from 4)
q.32 = φ(temp.25 from 2, q.41 from 5, q.41 from 4)
temp.31 = r.27 < d.2
conditional_jump temp.31 3 4

---- block 3 ----
return q.32

---- block 4 ----
temp.36 = r.27 - d.2
r.37 = temp.36
temp.39 = int 1
temp.40 = q.32 + imm(1)
q.41 = temp.40
jmp 0


----------- inline_small_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
jmp 2

---- block 2 ----
temp.43 = int 0
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.51 = int 1
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
temp.42 = φ(q.48 from 4)
temp.22 = temp.42
jmp 1

---- block 1 ----
storeprop temp.22, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = int 0
jmp 0

---- block 0 ----
r.27 = φ(n.1 from 2, r.37 from 5, r.37 from 4)
q.32 = φ(temp.25 from 2, q.41 from 5, q.41 from 4)
temp.31 = r.27 < d.2
conditional_jump temp.31 3 4

---- block 3 ----
return q.32

---- block 4 ----
temp.36 = r.27 - d.2
r.37 = temp.36
temp.39 = int 1
temp.40 = q.32 + imm(1)
q.41 = temp.40
jmp 0


----------- remove_unreferenced_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
jmp 2

---- block 2 ----
temp.43 = int 0
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.51 = int 1
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
temp.42 = φ(q.48 from 4)
temp.22 = temp.42
jmp 1

---- block 1 ----
storeprop temp.22, 0
return 


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
jmp 2

---- block 2 ----
temp.43 = int 0
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.51 = int 1
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
temp.22 = q.48
jmp 1

---- block 1 ----
storeprop temp.22, 0
return 


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.43 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
temp.22 = q.48
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.51 = int 1
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
storeprop temp.22, 0
jmp 1

---- block 1 ----
return 


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.43 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
temp.22 = q.48
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.51 = int 1
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
storeprop q.48, 0
jmp 1

---- block 1 ----
return 


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.43 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5)
q.48 = φ(temp.43 from 2, q.45 from 5)
temp.47 = r.46 < temp.21
conditional_jump temp.47 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3

---- block 7 ----
storeprop q.48, 0
jmp 1

---- block 1 ----
return 


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.43 = int 0
jmp 3

---- block 3 ----
r.46 = φ(temp.20 from 2, r.44 from 5, temp.20 from 0)
q.48 = φ(temp.43 from 2, q.45 from 5, temp.43 from 0)
temp.47 = r.46 < temp.21
conditional_jump temp.47 7 5

---- block 7 ----
storeprop q.48, 0
return 

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3


----------- unreferenced_blocks_in_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 100
getprop temp.21, 0
temp.43 = int 0
jmp 3

---- block 3 ----
r.46 = φ(r.44 from 5, temp.20 from 0)
q.48 = φ(q.45 from 5, temp.43 from 0)
temp.47 = r.46 < temp.21
conditional_jump temp.47 7 5

---- block 7 ----
storeprop q.48, 0
return 

---- block 5 ----
temp.49 = r.46 - temp.21
r.44 = temp.49
temp.50 = q.48 + imm(1)
q.45 = temp.50
jmp 3
