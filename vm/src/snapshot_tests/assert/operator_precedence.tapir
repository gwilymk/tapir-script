# Tests for operator precedence
extern fn assert(value: bool);

# Precedence (lowest to highest):
# 1. then
# 2. ||
# 3. &&
# 4. Comparison (==, !=, <, <=, >, >=)
# 5. Bitwise OR (|)
# 6. Bitwise AND (&)
# 7. Shift (<<, >>)
# 8. Addition (+, -)
# 9. Multiplication (*, /, %, //, %%)

# Multiplication before addition
assert(1 + 2 * 3 == 7);        # 1 + (2 * 3) = 7
assert(2 * 3 + 4 == 10);       # (2 * 3) + 4 = 10
assert(1 + 2 * 3 + 4 == 11);   # 1 + (2 * 3) + 4 = 11

# Addition before shift
assert(1 + 2 << 3 == 24);      # (1 + 2) << 3 = 24
assert(1 << 3 + 1 == 16);      # 1 << (3 + 1) = 16

# Shift before bitwise AND
assert(1 << 2 & 7 == 4);       # (1 << 2) & 7 = 4 & 7 = 4
assert(15 & 3 << 1 == 6);      # 15 & (3 << 1) = 15 & 6 = 6

# Bitwise AND before bitwise OR
assert(1 | 2 & 3 == 3);        # 1 | (2 & 3) = 1 | 2 = 3
assert(4 | 3 & 2 == 6);        # 4 | (3 & 2) = 4 | 2 = 6

# Bitwise OR before comparison
var cmp1 = 1 | 2 == 3;         # (1 | 2) == 3
assert(cmp1 == true);
var cmp2 = 0 | 0 == 0;         # (0 | 0) == 0
assert(cmp2 == true);

# Comparison before &&
var and1 = 1 < 2 && 3 < 4;     # (1 < 2) && (3 < 4)
assert(and1 == true);
var and2 = 1 > 2 && 3 < 4;     # (1 > 2) && (3 < 4)
assert(and2 == false);

# && before ||
var or1 = true || false && false;  # true || (false && false) = true
assert(or1 == true);
var or2 = false || true && true;   # false || (true && true) = true
assert(or2 == true);
var or3 = false || false && true;  # false || (false && true) = false
assert(or3 == false);

# Complex expression
# 2 + 3 * 4 << 1 & 255 | 1 == 57 && true
# = ((((2 + (3 * 4)) << 1) & 255) | 1) == 57 && true
# = (((2 + 12) << 1) & 255) | 1 == 57 && true
# = ((14 << 1) & 255) | 1 == 57 && true
# = (28 & 255) | 1 == 57 && true
# = 28 | 1 == 57 && true
# = 29 == 57 && true
# = false && true
# = false
var complex = 2 + 3 * 4 << 1 & 255 | 1 == 57 && true;
assert(complex == false);

# Subtraction and division
assert(10 - 6 / 2 == 7);       # 10 - (6 / 2) = 10 - 3 = 7
assert(20 / 4 - 2 == 3);       # (20 / 4) - 2 = 5 - 2 = 3

# Modulo same precedence as multiplication
assert(10 + 7 % 3 == 11);      # 10 + (7 % 3) = 10 + 1 = 11
assert(7 % 3 + 10 == 11);      # (7 % 3) + 10 = 1 + 10 = 11

# Parentheses override precedence
assert((1 + 2) * 3 == 9);
assert(1 * (2 + 3) == 5);
assert((1 << 2) + 3 == 7);
assert(1 << (2 + 3) == 32);
