# Tests for spawn and globals interaction
extern fn assert(value: bool);

# Multiple spawned tasks writing same global
global write_counter = 0;

fn writer() {
    write_counter = write_counter + 1;
}

spawn writer();
spawn writer();
spawn writer();
wait;
assert(write_counter == 3);

# Interleaved execution with globals
global sequence = 0;

fn add_one() {
    sequence = sequence + 1;
}

fn add_ten() {
    sequence = sequence + 10;
}

fn add_hundred() {
    sequence = sequence + 100;
}

spawn add_one();
spawn add_ten();
spawn add_hundred();
wait;
assert(sequence == 111);

# Spawn modifying global struct fields
global g_struct: int2;

fn set_struct_fields(x: int, y: int) {
    g_struct.x = x;
    g_struct.y = y;
}

spawn set_struct_fields(100, 200);
wait;
assert(g_struct.x == 100);
assert(g_struct.y == 200);
