# Tests for loop edge cases
extern fn assert(value: bool);

# Loop with immediate break
var immediate = 0;
loop {
    break;
    immediate = 999;  # Never reached
}
assert(immediate == 0);

# Loop with conditional break at start
var count1 = 0;
loop {
    if true {
        break;
    }
    count1 = count1 + 1;
}
assert(count1 == 0);

# Continue at end (no effect)
var count2 = 0;
var i = 0;
loop {
    if i >= 3 {
        break;
    }
    count2 = count2 + 1;
    i = i + 1;
    continue;
}
assert(count2 == 3);

# Continue skipping rest of loop body
var sum = 0;
var j = 0;
loop {
    j = j + 1;
    if j > 5 {
        break;
    }
    if j == 3 {
        continue;  # Skip adding 3
    }
    sum = sum + j;
}
assert(sum == 12);  # 1 + 2 + 4 + 5 = 12

# Nested loops
var outer_count = 0;
var inner_count = 0;
var k = 0;
loop {
    if k >= 3 {
        break;
    }
    outer_count = outer_count + 1;
    var m = 0;
    loop {
        if m >= 2 {
            break;
        }
        inner_count = inner_count + 1;
        m = m + 1;
    }
    k = k + 1;
}
assert(outer_count == 3);
assert(inner_count == 6);  # 3 * 2

# Break only affects innermost loop
var outer_runs = 0;
var inner_runs = 0;
var n = 0;
loop {
    if n >= 2 {
        break;
    }
    outer_runs = outer_runs + 1;
    var p = 0;
    loop {
        if p >= 10 {
            break;  # Only breaks inner loop
        }
        inner_runs = inner_runs + 1;
        p = p + 1;
    }
    n = n + 1;
}
assert(outer_runs == 2);
assert(inner_runs == 20);

# Continue only affects innermost loop
var outer_sum = 0;
var inner_sum = 0;
var q = 0;
loop {
    q = q + 1;
    if q > 2 {
        break;
    }
    outer_sum = outer_sum + q;
    var r = 0;
    loop {
        r = r + 1;
        if r > 3 {
            break;
        }
        if r == 2 {
            continue;  # Skip r=2
        }
        inner_sum = inner_sum + r;
    }
}
assert(outer_sum == 3);  # 1 + 2
assert(inner_sum == 8);  # (1 + 3) + (1 + 3) = 8

# Loop with multiple conditions
var multi_cond = 0;
var x = 0;
loop {
    x = x + 1;
    if x > 10 {
        break;
    }
    if x < 5 {
        continue;
    }
    multi_cond = multi_cond + 1;
}
assert(multi_cond == 6);  # x = 5,6,7,8,9,10

# Loop with computation before break check
var compute_first = 0;
var y = 0;
loop {
    compute_first = compute_first + y;
    if y >= 5 {
        break;
    }
    y = y + 1;
}
assert(compute_first == 15);  # 0 + 1 + 2 + 3 + 4 + 5 = 15
